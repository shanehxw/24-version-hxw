## 能量机关识别任务

### 代码思路
    灰度图处理 + BGR处理-> 取交集得到二值图

    激活矩形识别：形态学滤波，使激活矩形相连-> findContours-> minAreaRect-> 面积阈值和长宽比阈值筛选矩形-> 顺便通过roi、面积和长宽比阈值筛选R标-> 得到初步矩形位置

    靶心识别：形态学滤波，使靶心各环分离-> findContours-> 计算各个轮廓质心坐标-> 剔除R标周围点-> minAreaRect ->长宽比、对角线长度筛选

    靶心点的分类和聚合：把靶心识别得到的点根据点与点的距离分为三类：1、正常点：大部分距离在正常区间内，获取 2、异常点：大部分距离在异常区间，舍去 3、相近点：两个或以上的点在极小范围内接近，聚类求平均点 ——> 对每组相近点，先求其平均值，然后根据各点与平均值的距离计算权重，然后通过权重修正

    靶心的角度检测：计算各目标靶心与R标的与水平轴的角度，然后显示在屏幕左上角
### 遇到问题
    1、滤波时有一片扇叶难以得到连接完整的轮廓，在使用形态学处理解决该问题时，又会出现两片扇叶连接在一起、环数较高的靶心粘连成一整块的情况
    2、使用角度对识别出的矩形进行分组时，因为像素的扰动，让矩形在竖直和水平时出现异常情况
    3、靶心识别时出现使用长宽比、半径长度等单体阈值无法排除的拟合圆
    4、靶心识别过程中出现邻近点，噪声点
    5、聚合后的靶心点依然不稳定，受到较远点的影响较深
    6、靶心点识别不好，有时只能识别3-4个靶心点
### 解决思路
    1、尝试使用靶心识别方法，利用boundingrect直接识别靶心，但是这样可能因为靶心太小而出现较大的误差，因此可能要两种方法一起使用然后加权,这样也能检测该靶心是否已经被激活，但是需要额外的匹配步骤
    2、使用补偿条件：|angle1+angle2-90| < k和|angle1 + angle2 -180| < k,但是因为矩形选取时扰动太剧烈，导致阈值较大，可能出现错误分组情况 --换用中心点距离阈值 --但是矩形中心点距离较为相近，难以通过此方法识别 --尝试换用靶心辅助识别矩形对 --或者不用识别矩形对，直接识别需要击打的靶心
    3、使用圆心距离过滤：遍历圆心点，长度过长continnue，长度在中间删去
    4、需要对点进行分类，首先根据距离判断三种点，然后保留正常点、舍去异常点、对邻近点进行简单聚合
    5、选取有关比例的函数，让较远点对聚合的影响较小 --变好了些，但是依然会出现跳跃问题，因为在求方差之前需要平均值，平均值受较远点影响很深 --尝试缩小聚合半径，让跳跃较小，然后变为处理多个相近点的问题,我个人目前的想法是，先解决预测的问题，让前一帧所得到的预测点来排除干扰点
    6、对上两帧的中心点进行分析，判断当前帧是否误识别，或者不稳定，对当前帧的中心点进行补偿 --后来发现在聚合递归的时候因为点较为相近，使得正确点被舍弃，因此，首先在靶心检测主函数中对检测出来的R标周围的点进行剔除,同时在合理范围内缩小阈值
### 效果图
### 待改进部分
    1、靶心有时识别不好，需要对阈值或者算法进行调整：
    2、靶心位置不稳定，估计对预测会造成较大干扰
    3、激活矩形筛选策略可以更优化：通过靶心和R标位置找到激活矩形Roi，然后通过更加极端的二值化和滤波处理得到更加稳定的矩形
    4、相近点聚合的策略不好，需要重新考虑聚合的算法
### 改进思路：
    滤波调整，让多同心圆部分不能太连在一起 完成
    利用父子轮廓进行筛选 --测试得，父子轮廓筛选需要一个好的滤波调整
### 总结